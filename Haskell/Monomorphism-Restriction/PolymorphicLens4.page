---
format: markdown+lhs
title: How to Write a Lens for Data with Polymorphic Members?
...

- This document should doctest.

Now, let's try writing a lens for the `Speaker` type.

> {-# LANGUAGE ImpredicativeTypes, RankNTypes, TemplateHaskell #-}
> {-# OPTIONS -Wall -fno-warn-unused-do-bind #-}
> import Control.Monad.Trans.State.Strict
> import Control.Monad.IO.Class
> import Data.Lens.Strict
> import Data.Lens.Template (makeLenses)
>
> newtype Speech = Speech (Show a => a -> String)
> data Speaker = Speaker
>   { _speak :: Speech}
> $(makeLenses [''Speaker])



> geisha :: Speaker
> geisha = Speaker $ Speech ((++" dosu.") . show)

> -- | The output of the main program should be as follows.
> --
> -- >>> main
> -- 130 dosu.
> -- 390 de gozaru.
>
> main :: IO ()
> main = flip evalStateT geisha $ do
>   putSpeak (130 :: Int)
>   speak ~= Speech ((++" de gozaru.") . show)
>   putSpeak (390 :: Int)
>     where
>       putSpeak x = do
>         Speech f <- access speak
>         liftIO $ putStrLn $ f x